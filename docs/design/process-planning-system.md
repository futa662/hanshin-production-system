# 工程計画システム設計書

## 1. 現状分析と課題

### 現状の運用
- **工程計画**: 工場長がExcelで3-6ヶ月先まで管理
- **更新頻度**: 毎週土日に現場長が手動更新
- **作業指示**: 紙の作業指示書（約10項目/日）
- **進捗管理**: バーコード読み取りによる完了報告のみ
- **課題**: 
  - 現場長の負荷が高い
  - リアルタイムでの進捗把握が困難
  - 計画の柔軟な変更が困難
  - 紙ベースの非効率な運用

## 2. システム要件

### 機能要件
1. **工程計画管理**
   - 3-6ヶ月先までの工程計画作成・編集
   - ドラッグ&ドロップによる直感的なスケジュール変更
   - 機械稼働状況と連動した自動最適化提案
   - 予実管理機能

2. **作業指示管理**
   - デジタル作業指示書の作成・配信
   - タブレットでの作業開始・終了報告
   - リアルタイム進捗表示
   - 作業履歴の自動記録

3. **統合機能**
   - 基幹システムからの受注データ連携
   - 既存の機械監視システムとの連動
   - スタッフ管理システムとの連携

### 非機能要件
- **パフォーマンス**: 150台の機械×100名のスタッフ規模でもスムーズ動作
- **可用性**: 24時間365日稼働
- **ユーザビリティ**: 現場作業員でも直感的に操作可能
- **拡張性**: 将来的な機能追加に対応

## 3. データモデル設計

### 主要エンティティ

```typescript
// 工程計画
interface ProcessPlan {
  id: string;
  orderId: string;              // 受注ID
  productName: string;          // 製品名
  quantity: number;             // 数量
  startDate: Date;              // 開始予定日
  endDate: Date;                // 完了予定日
  status: 'planned' | 'in_progress' | 'completed' | 'delayed';
  tasks: Task[];                // 作業タスク一覧
  assignedMachines: string[];   // 割当機械ID
  priority: 'high' | 'medium' | 'low';
  actualStartDate?: Date;       // 実績開始日
  actualEndDate?: Date;         // 実績完了日
}

// 作業タスク
interface Task {
  id: string;
  planId: string;               // 工程計画ID
  taskCode: string;             // タスクコード（バーコード代替）
  title: string;                // 作業項目名
  description: string;          // 作業内容
  estimatedHours: number;       // 予定作業時間
  actualHours?: number;         // 実績作業時間
  sequence: number;             // 作業順序
  status: 'pending' | 'in_progress' | 'completed';
  assignedStaff: string[];      // 担当スタッフID
  assignedMachine?: string;     // 使用機械ID
  startedAt?: Date;             // 開始時刻
  completedAt?: Date;           // 完了時刻
  dependencies: string[];       // 前提タスクID
}

// 作業指示書
interface WorkInstruction {
  id: string;
  date: Date;                   // 作業日
  shiftType: 'day' | 'night';   // シフト
  tasks: DailyTask[];           // その日の作業項目
  createdBy: string;            // 作成者（現場長）
  status: 'draft' | 'published' | 'in_progress' | 'completed';
}

// 日次作業項目
interface DailyTask {
  id: string;
  taskId: string;               // タスクID（参照）
  instructionId: string;        // 作業指示書ID
  sequence: number;             // 実行順序
  staffIds: string[];           // 担当スタッフ
  machineId: string;            // 使用機械
  status: 'waiting' | 'in_progress' | 'completed';
  startedAt?: Date;
  completedAt?: Date;
  notes?: string;               // 作業メモ
}
```

## 4. システムアーキテクチャ

### 全体構成
```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   基幹システム    │────▶│  工程計画システム  │────▶│   現場タブレット  │
│  (受注データ)    │     │   (本システム)    │     │   (作業報告)     │
└─────────────────┘     └─────────────────┘     └─────────────────┘
                               │       │
                               ▼       ▼
                        ┌──────────┐ ┌──────────┐
                        │機械監視   │ │スタッフ   │
                        │システム   │ │管理      │
                        └──────────┘ └──────────┘
```

### 技術スタック拡張
- **既存**: Next.js, TypeScript, Tailwind CSS, Zustand
- **追加予定**:
  - **Ganttチャート**: @bryntum/gantt-react または dhtmlx-gantt
  - **ドラッグ&ドロップ**: @dnd-kit/sortable
  - **タブレット対応**: PWA化（next-pwa）
  - **データ同期**: TanStack Query
  - **リアルタイム**: Socket.io または Pusher

## 5. UI/UX設計

### 画面構成

1. **工程計画ダッシュボード**
   - ガントチャート表示（月/週/日切替）
   - フィルター（機械/製品/ステータス）
   - ドラッグ&ドロップでのスケジュール調整
   - 予実比較ビュー

2. **作業指示管理画面**
   - カレンダービュー
   - 日次作業リスト作成
   - 一括/個別割当機能
   - QRコード生成（バーコード代替）

3. **タブレット用作業画面**
   - シンプルな作業リスト
   - ワンタップ開始/完了
   - 進捗バー表示
   - 問題報告機能

4. **分析画面**
   - 予実差分析
   - ボトルネック分析
   - 生産性トレンド
   - 改善提案表示

### 操作フロー

```
【計画作成】
1. 基幹システムから受注データ取得
2. AIによる初期スケジュール案生成
3. ガントチャート上で手動調整
4. 作業タスクへの分解と割当

【日次運用】
1. 前日夜に翌日の作業指示書を自動生成
2. 現場長が確認・調整
3. タブレットに配信
4. 作業員が進捗報告

【進捗管理】
1. リアルタイムダッシュボードで監視
2. 遅延アラート自動通知
3. 必要に応じてスケジュール再調整
4. 実績データの蓄積と分析
```

## 6. 実装計画

### Phase 1: 基盤構築（2週間）
- データモデル実装
- API設計・実装
- 基本的なCRUD機能

### Phase 2: 工程計画機能（3週間）
- ガントチャート実装
- ドラッグ&ドロップ機能
- 基幹システム連携

### Phase 3: 作業指示機能（2週間）
- 作業指示書作成機能
- QRコード生成
- タブレット用UI

### Phase 4: 統合・最適化（2週間）
- 既存システムとの連携
- パフォーマンス最適化
- テスト・デバッグ

### Phase 5: 分析機能（1週間）
- 予実管理機能
- レポート機能
- AI最適化提案

## 7. 移行計画

1. **並行運用期間**: 1ヶ月
   - 紙とデジタルの併用
   - 段階的な切替

2. **トレーニング**
   - 現場長向け: 2日間
   - 作業員向け: 半日×シフト別

3. **サポート体制**
   - 初期1ヶ月は常駐サポート
   - その後はリモートサポート

## 8. 期待効果

- **現場長の作業時間**: 週16時間 → 週4時間（75%削減）
- **計画変更対応時間**: 2時間 → 15分（87.5%削減）
- **進捗把握**: リアルタイム化
- **生産性**: 10-15%向上（最適化による）
- **ペーパーレス**: 年間約36,500枚削減

## 9. リスクと対策

| リスク | 影響度 | 対策 |
|-------|--------|------|
| 現場の抵抗感 | 高 | 段階的導入、十分なトレーニング |
| システム障害 | 高 | バックアップ体制、紙での代替手段 |
| データ移行ミス | 中 | 並行運用期間の設定 |
| パフォーマンス問題 | 中 | 事前の負荷テスト実施 |

---
作成日: 2024-12-20
作成者: Claude